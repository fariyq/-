<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ржЗржиржнрзЯрзЗрж╕ рж╕рж┐рж╕рзНржЯрзЗржо</title>
    <link rel="stylesheet" href="style.css">

    <!-- Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.2/firebase-database.js"></script>
    <script>
        // Firebase config (ржЖржкржирж╛рж░ Firebase ржХржиржлрж┐ржЧ)
        const firebaseConfig = {
            apiKey: "AIzaSyAFx9Szt_sbhhtWEqHgIU5jUz3qxD0jOMo",
            authDomain: "bishwasher-khamar.firebaseapp.com",
            projectId: "bishwasher-khamar",
            storageBucket: "bishwasher-khamar.firebasestorage.app",
            messagingSenderId: "466255017082",
            appId: "1:466255017082:web:902506f7358dfd5a82b7c3",
            measurementId: "G-457DQ0ZHHG"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        function saveInvoiceToFirebase() {
            const invoiceNumber = document.getElementById("invoiceNumber").value;
            const customerName = document.getElementById("customerName").value;
            const items = [];
            const rows = document.getElementById("invoiceBody").children;
            for (let row of rows) {
                const productName = row.querySelector(".productName").value;
                const quantity = row.querySelector(".quantity").value;
                const price = row.querySelector(".price").value;
                const total = row.querySelector(".total").innerText;
                items.push({ productName, quantity, price, total });
            }

            const totalAmount = document.getElementById("grandTotal").innerText.replace(" ржЯрж╛ржХрж╛", "");
            const paidAmount = document.getElementById("paidAmount").value;
            const dueAmount = document.getElementById("dueAmount").innerText.replace(" ржЯрж╛ржХрж╛", "");
            const returnAmount = document.getElementById("returnAmount").innerText.replace(" ржЯрж╛ржХрж╛", "");
            const dueDate = document.getElementById("dueDate").value;

            // Save data to Firebase Realtime Database
            const invoiceRef = database.ref("invoices/" + invoiceNumber);
            invoiceRef.set({
                customerName,
                items,
                totalAmount,
                paidAmount,
                dueAmount,
                returnAmount,
                dueDate,
                date: new Date().toISOString()
            }).then(() => {
                alert("ржЗржиржнрзЯрзЗрж╕ рж╕рзЗржн рж╣рзЯрзЗржЫрзЗ!");
            }).catch(error => {
                console.error("Error saving invoice: ", error);
            });
        }
    </script>
</head>
<body onload="updateDateTime(); generateInvoiceNumber();">
    <div class="header">
        <h2>ржЗржорж░рж╛ржи ржЗрж▓рзЗржХржЯрзНрж░ржирж┐ржХрзНрж╕ ржЕрзНржпрж╛ржирзНржб ржорзЛржмрж╛ржЗрж▓ рж╕рж╛рж░рзНржнрж┐рж╕рж┐ржВ рж╕рзЗржирзНржЯрж╛рж░</h2>
        <p>ЁЯУН ржЧржжржЦрж╛рж▓рж┐ ржмрж╛ржЬрж╛рж░ ржмрж╛рж╕ рж╕рзНржЯрзНржпрж╛ржирзНржб, рж░рж╣рж┐ржо рж╕рж░ржжрж╛рж░ ржорж╛рж░рзНржХрзЗржЯ, ржЭрж┐ржХрж░ржЧрж╛ржЫрж╛, ржпрж╢рзЛрж░ред</p>
        <p>ЁЯУз mdemranst0@gmail.com | ЁЯУЮ 01952325903</p>
        <p>ЁЯУЕ <span id="currentDate"></span> | тП░ <span id="currentTime"></span></p>
    </div>

    <div class="container">
        <h2>ржЗржиржнрзЯрзЗрж╕ рждрзИрж░рж┐ ржХрж░рзБржи</h2>

        <label for="invoiceNumber">ржЗржиржнрзЯрзЗрж╕ ржирж╛ржорзНржмрж╛рж░:</label>
        <input type="text" id="invoiceNumber" readonly><br><br>

        <label for="customerName">ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ ржирж╛ржо:</label>
        <input type="text" id="customerName" placeholder="ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ ржирж╛ржо рж▓рж┐ржЦрзБржи"><br><br>

        <table>
            <thead>
                <tr>
                    <th>ржХрзНрж░ржорж┐ржХ</th> 
                    <th>ржкржгрзНржп ржирж╛ржо</th>
                    <th>ржкрж░рж┐ржорж╛ржг</th>
                    <th>ржПржХржХ ржорзВрж▓рзНржп</th>
                    <th>ржорзЛржЯ</th>
                    <th class="no-print">ржЕржкрж╢ржи</th>
                </tr>
            </thead>
            <tbody id="invoiceBody"></tbody>
        </table>

        <button class="no-print" onclick="addItem()">+ ржЖржЗржЯрзЗржо ржпрзЛржЧ ржХрж░рзБржи</button>

        <div class="total-section">
            <div class="total-info">
                <p><strong>ржорзЛржЯ ржорзВрж▓рзНржп:</strong> <span id="grandTotal">0 ржЯрж╛ржХрж╛</span></p>
                <p><strong>ржЬржорж╛ ржЯрж╛ржХрж╛:</strong> <input type="number" id="paidAmount" oninput="calculateDue()" placeholder="ржЬржорж╛ ржЯрж╛ржХрж╛ рж▓рж┐ржЦрзБржи"></p>
                <p><strong>ржмрж╛ржХрж┐ ржЯрж╛ржХрж╛:</strong> <span id="dueAmount">0 ржЯрж╛ржХрж╛</span></p>
                <p><strong>ржлрзЗрж░ржд ржЯрж╛ржХрж╛:</strong> <span id="returnAmount">0 ржЯрж╛ржХрж╛</span></p>
                
                <!-- ржмрж╛ржХрж┐ ржЯрж╛ржХрж╛ ржжрзЗржУржпрж╝рж╛рж░ рждрж╛рж░рж┐ржЦ ржЕржкрж╢ржи -->
                <div id="dueDateContainer" style="display: none; margin-top: 10px;">
                    <label for="dueDate"><strong>ржмрж╛ржХрж┐ ржЯрж╛ржХрж╛ ржжрзЗржУржпрж╝рж╛рж░ рждрж╛рж░рж┐ржЦ:</strong></label>
                    <input type="date" id="dueDate">
                </div>
            </div>
        </div>

        <h3 id="paymentStatus" style="color: green; display: none;">тЬЕ ржкрж░рж┐рж╢рзЛржзрж┐ржд</h3>

        <div class="signature-section">
            <div class="signature-box">
                <p>ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ рж╕рзНржмрж╛ржХрзНрж╖рж░:</p>
                <div class="signature-line"></div>
            </div>
            <div class="signature-box">
                <p>ржмрж┐ржХрзНрж░рзЗрждрж╛рж░ рж╕рзНржмрж╛ржХрзНрж╖рж░:</p>
                <div class="signature-line"></div>
            </div>
        </div>

        <button class="no-print" onclick="printInvoice()">ЁЯЦия╕П ржкрзНрж░рж┐ржирзНржЯ ржХрж░рзБржи</button>

        <!-- ржЗржиржнрзЯрзЗрж╕ рж╕рж╛рж░рзНржЪ ржХрж░рж╛рж░ ржЬржирзНржп -->
        <label for="searchInvoiceNumber">ржЗржиржнрзЯрзЗрж╕ ржирж╛ржорзНржмрж╛рж░ ржжрж┐рзЯрзЗ ржЦрзБржБржЬрзБржи:</label>
        <input type="text" id="searchInvoiceNumber" placeholder="ржЗржиржнрзЯрзЗрж╕ ржирж╛ржорзНржмрж╛рж░ рж▓рж┐ржЦрзБржи">
        <button onclick="searchInvoice()">ржЦрзБржБржЬрзБржи</button>

        <!-- рж╕рзЗржн ржХрж░рж╛рж░ ржЬржирзНржп ржмрж╛ржЯржи -->
        <button class="no-print" onclick="saveInvoiceToFirebase()">ЁЯТ╛ рж╕рзЗржн ржХрж░рзБржи</button>
    </div>

    <script src="script.js"></script>
</body>
</html>